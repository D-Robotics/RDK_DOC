"use strict";(self.webpackChunkrdk_doc=self.webpackChunkrdk_doc||[]).push([[7402],{19365:(e,t,n)=>{n.d(t,{A:()=>i});n(96540);var o=n(34164);const s={tabItem:"tabItem_Ymn6"};var r=n(74848);function i(e){let{children:t,hidden:n,className:i}=e;return(0,r.jsx)("div",{role:"tabpanel",className:(0,o.A)(s.tabItem,i),hidden:n,children:t})}},28453:(e,t,n)=>{n.d(t,{R:()=>i,x:()=>a});var o=n(96540);const s={},r=o.createContext(s);function i(e){const t=o.useContext(r);return o.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),o.createElement(r.Provider,{value:t},e.children)}},33955:(e,t,n)=>{n.d(t,{A:()=>o});const o=n.p+"assets/images/video_boxs_workflow2-498bcaf37adb1234036fe33844f8b836.jpg"},37960:(e,t,n)=>{n.d(t,{A:()=>o});const o=n.p+"assets/images/video_box_detection-d528a8bae07eaffe8beb972469b8d095.jpg"},78973:(e,t,n)=>{n.d(t,{A:()=>o});const o=n.p+"assets/images/video_boxs_workflow-fd2de869d9658da16bae338f99bf797f.jpg"},80138:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>l,default:()=>p,frontMatter:()=>a,metadata:()=>d,toc:()=>u});var o=n(74848),s=n(28453),r=n(93859),i=n(19365);const a={sidebar_position:9},l="5.4.9 Video Boxs",d={id:"Robot_development/apps/video_boxs",title:"5.4.9 Video Boxs",description:"Introduction",source:"@site/i18n/en/docusaurus-plugin-content-docs/current/05_Robot_development/04_apps/video_boxs.md",sourceDirName:"05_Robot_development/04_apps",slug:"/Robot_development/apps/video_boxs",permalink:"/rdk_doc/en/Robot_development/apps/video_boxs",draft:!1,unlisted:!1,editUrl:"https://github.com/D-Robotics/rdk_doc/blob/main/docs/05_Robot_development/04_apps/video_boxs.md",tags:[],version:"current",sidebarPosition:9,frontMatter:{sidebar_position:9},sidebar:"tutorialSidebar",previous:{title:"5.4.8 Car Parking Space Search",permalink:"/rdk_doc/en/Robot_development/apps/parking_search"},next:{title:'5.5.1 Using "zero-copy"',permalink:"/rdk_doc/en/Robot_development/tros_dev/zero_copy"}},c={},u=[{value:"Introduction",id:"introduction",level:2},{value:"Supported Platforms",id:"supported-platforms",level:2},{value:"Preparation",id:"preparation",level:2},{value:"RDK",id:"rdk",level:3},{value:"Usage",id:"usage",level:2},{value:"RDK",id:"rdk-1",level:3},{value:"Result Analysis",id:"result-analysis",level:2}];function h(e){const t={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,s.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(t.h1,{id:"549-video-boxs",children:"5.4.9 Video Boxs"}),"\n","\n",(0,o.jsx)(t.h2,{id:"introduction",children:"Introduction"}),"\n",(0,o.jsx)(t.p,{children:"The app is used to Intelligent Analysis of IPC video stream input . The app consists of RTSP video stream, body and face\ndetection, image coding and decoding, and a web display interface. The workflow is shown in the following diagram:"}),"\n",(0,o.jsx)(t.p,{children:(0,o.jsx)(t.img,{src:n(78973).A+"",width:"2352",height:"1638"})}),"\n",(0,o.jsx)(t.p,{children:"In actual customer applications, the display part is completed by the customer's business system. The app consists of\nRTSP video stream, body and face detection, image coding and decoding. The workflow is shown in the following diagram:"}),"\n",(0,o.jsx)(t.p,{children:(0,o.jsx)(t.img,{src:n(33955).A+"",width:"1708",height:"316"})}),"\n",(0,o.jsxs)(t.p,{children:["Code Repository:  (",(0,o.jsx)(t.a,{href:"https://github.com/D-Robotics/hobot_rtsp_client.git",children:"https://github.com/D-Robotics/hobot_rtsp_client.git"}),")"]}),"\n",(0,o.jsx)(t.h2,{id:"supported-platforms",children:"Supported Platforms"}),"\n",(0,o.jsxs)(t.table,{children:[(0,o.jsx)(t.thead,{children:(0,o.jsxs)(t.tr,{children:[(0,o.jsx)(t.th,{children:"Platform"}),(0,o.jsx)(t.th,{children:"System"}),(0,o.jsx)(t.th,{children:"Function"})]})}),(0,o.jsx)(t.tbody,{children:(0,o.jsxs)(t.tr,{children:[(0,o.jsx)(t.td,{children:"RDK X3, RDK X3 Module, RDK X5"}),(0,o.jsx)(t.td,{children:"Ubuntu 22.04"}),(0,o.jsx)(t.td,{children:"Start RTSP Client for receive video stream , and from H264 deceoded to NV12,  perform body face keypoints detection, and display the detection effect in Web"})]})})]}),"\n",(0,o.jsx)(t.h2,{id:"preparation",children:"Preparation"}),"\n",(0,o.jsx)(t.h3,{id:"rdk",children:"RDK"}),"\n",(0,o.jsxs)(t.ol,{children:["\n",(0,o.jsxs)(t.li,{children:["\n",(0,o.jsx)(t.p,{children:"RDK has been flashed with the Ubuntu 22.04 system image provided by D-Robotics."}),"\n"]}),"\n",(0,o.jsxs)(t.li,{children:["\n",(0,o.jsx)(t.p,{children:"TogetheROS.Bot has been successfully installed on RDK."}),"\n"]}),"\n",(0,o.jsxs)(t.li,{children:["\n",(0,o.jsx)(t.p,{children:"Get IPC devices that support RTSP stream of H264/H265\uff0cand configure IP addresses for the same network segment."}),"\n"]}),"\n",(0,o.jsxs)(t.li,{children:["\n",(0,o.jsx)(t.p,{children:"The PC used for RDK should be in the same network segment (either wired or connected to the same wireless network,\nwith the first three parts of the IP address being consistent)."}),"\n"]}),"\n",(0,o.jsxs)(t.li,{children:["\n",(0,o.jsx)(t.p,{children:"Setup system"}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-bash",children:'sudo bash -c "echo performance > /sys/devices/system/cpu/cpufreq/policy0/scaling_governor"\n'})}),"\n",(0,o.jsxs)(t.ol,{start:"6",children:["\n",(0,o.jsxs)(t.li,{children:["When run more pipeline, set 1G of ion_size.refor\nto ",(0,o.jsx)(t.a,{href:"https://developer.d-robotics.cc/rdk_doc/System_configuration/srpi-config",children:"srpi-config"})]}),"\n"]}),"\n",(0,o.jsx)(t.h2,{id:"usage",children:"Usage"}),"\n",(0,o.jsx)(t.h3,{id:"rdk-1",children:"RDK"}),"\n",(0,o.jsx)(t.p,{children:(0,o.jsx)(t.strong,{children:"Start Pipeline with web"})}),"\n",(0,o.jsx)(r.A,{groupId:"tros-distro",children:(0,o.jsx)(i.A,{value:"humble",label:"Humble",children:(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-shell",children:"source /opt/tros/humble/setup.bash\n\nexport ROS_DOMAIN_ID=101\n\ncp -r /opt/tros/${TROS_DISTRO}/lib/mono2d_body_detection/config/ .\n\nros2 launch hobot_rtsp_client hobot_rtsp_client_ai_websocket.launch.py hobot_rtsp_url_num:=1 hobot_rtsp_url_0:='rtsp://admin:admin123@10.112.148.57:554/0' hobot_transport_0:='udp'  websocket_channel:=0\n"})})})}),"\n",(0,o.jsx)(t.p,{children:(0,o.jsx)(t.strong,{children:"Start Pipeline of component"})}),"\n",(0,o.jsx)(r.A,{groupId:"tros-distro",children:(0,o.jsx)(i.A,{value:"humble",label:"Humble",children:(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-shell",children:"source /opt/tros/humble/setup.bash\n\nexport ROS_DOMAIN_ID=103\n\ncp -r /opt/tros/${TROS_DISTRO}/lib/mono2d_body_detection/config/ .\n\nros2 launch hobot_rtsp_client hobot_rtsp_client_ai_websocket_plugin.launch.py hobot_rtsp_url_num:=1 hobot_rtsp_url_0:='rtsp://admin:admin123@10.112.148.57:554/0' hobot_transport_0:='udp'  websocket_channel:=0\n"})})})}),"\n",(0,o.jsx)(t.p,{children:(0,o.jsx)(t.strong,{children:"Start Pipeline without web"})}),"\n",(0,o.jsx)(r.A,{groupId:"tros-distro",children:(0,o.jsx)(i.A,{value:"humble",label:"Humble",children:(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-shell",children:"source /opt/tros/humble/setup.bash\n\nexport ROS_DOMAIN_ID=105\n\ncp -r /opt/tros/${TROS_DISTRO}/lib/mono2d_body_detection/config/ .\n\nros2 launch hobot_rtsp_client hobot_rtsp_client_ai.launch.py hobot_rtsp_url_num:=1 hobot_rtsp_url_0:='rtsp://admin:admin123@10.112.148.57:554/0' hobot_transport_0:='udp'\n"})})})}),"\n",(0,o.jsx)(t.p,{children:(0,o.jsx)(t.strong,{children:"attention"})}),"\n",(0,o.jsxs)(t.ol,{children:["\n",(0,o.jsx)(t.li,{children:"ROS_SOMAIN-ID must be configured.when start multiple pipeline in a local area network."}),"\n",(0,o.jsx)(t.li,{children:'The launch with "_plugin" is component mode.'}),"\n",(0,o.jsx)(t.li,{children:'When start multiple pipeline with "_websocket", Don\'t view multiple channel stream on web.'}),"\n"]}),"\n",(0,o.jsx)(t.h2,{id:"result-analysis",children:"Result Analysis"}),"\n",(0,o.jsx)(t.p,{children:"The following information is outputted in the terminal when running on the RDK."}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-text",children:"[hobot_codec_republish-2] [WARN] [1732169402.355433988] [hobot_codec_decoder]: Sub imgRaw fps = -1774563328\n[hobot_codec_republish-2] [WARN] [1732169402.906547961] [hobot_codec_decoder]: sub h264 1920x1080, fps: 24.7706, pub nv12, fps: 9.17431, comm delay [-8.8148]ms, codec delay [171.2000]ms\n[mono2d_body_detection-4] [WARN] [1732169402.906916796] [mono2d_body_det]: SharedMemImgProcess Recved img encoding: nv12, h: 1080, w: 1920, step: 1920, index: 2508, stamp: 1732169402_735947000, data size: 3133440, comm delay [170.9541]ms\n[hobot_codec_republish-3] [WARN] [1732169403.274412126] [hobot_codec_encoder]: sub nv12 1920x1088, fps: 10.8055, pub jpeg, fps: 10.8055, comm delay [164.9091]ms, codec delay [7.6364]ms\n[mono2d_body_detection-4] [WARN] [1732169403.321086039] [mono2d_body_det]: input fps: 10.81, out fps: 10.81, infer time ms: 92, post process time ms: 10\n[hobot_codec_republish-2] [WARN] [1732169403.946849482] [hobot_codec_decoder]: sub h264 1920x1080, fps: 25, pub nv12, fps: 10.5769, comm delay [-7.0000]ms, codec delay [168.2727]ms\n\n"})}),"\n",(0,o.jsxs)(t.p,{children:["Use the command ",(0,o.jsx)(t.code,{children:"ros2 topic list"}),"on other terminal,the topic is as below\uff1a"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-shell",children:"$ ros2 topic list\n/hobot_mono2d_body_detection\n/image_decode\n/image_mjpeg\n/parameter_events\n/rosout\n/rtsp_image_ch_0\n\n"})}),"\n",(0,o.jsxs)(t.p,{children:["Among them, ",(0,o.jsx)(t.code,{children:"/rtsp_image_ch_0"})," is h264/h265 stream from IPC through RTSP protocol, ",(0,o.jsx)(t.code,{children:"/hobot_mono2d_body_detection"})," is the\nalgorithm message published by the RDK which contains the human body and face detection results, and ",(0,o.jsx)(t.code,{children:"/image_decode"})," is\nfrom h264 decoded to NV12 image,",(0,o.jsx)(t.code,{children:"/image_mjpeg"})," is from nv12 coded to jpeg image."]}),"\n",(0,o.jsxs)(t.p,{children:["In the PC's browser, enter ",(0,o.jsx)(t.code,{children:"http://IP:8000"}),", and the body detection frame, keypoints, and pose detection results will be\ndisplayed in the web interface (IP refers to the IP address of the RDK):"]}),"\n",(0,o.jsx)(t.p,{children:(0,o.jsx)(t.img,{src:n(37960).A+"",width:"1908",height:"906"})})]})}function p(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,o.jsx)(t,{...e,children:(0,o.jsx)(h,{...e})}):h(e)}},93859:(e,t,n)=>{n.d(t,{A:()=>y});var o=n(96540),s=n(34164),r=n(86641),i=n(56347),a=n(205),l=n(38874),d=n(24035),c=n(82993);function u(e){return o.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,o.isValidElement)(e)&&function(e){const{props:t}=e;return!!t&&"object"==typeof t&&"value"in t}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function h(e){const{values:t,children:n}=e;return(0,o.useMemo)((()=>{const e=t??function(e){return u(e).map((e=>{let{props:{value:t,label:n,attributes:o,default:s}}=e;return{value:t,label:n,attributes:o,default:s}}))}(n);return function(e){const t=(0,d.X)(e,((e,t)=>e.value===t.value));if(t.length>0)throw new Error(`Docusaurus error: Duplicate values "${t.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[t,n])}function p(e){let{value:t,tabValues:n}=e;return n.some((e=>e.value===t))}function b(e){let{queryString:t=!1,groupId:n}=e;const s=(0,i.W6)(),r=function(e){let{queryString:t=!1,groupId:n}=e;if("string"==typeof t)return t;if(!1===t)return null;if(!0===t&&!n)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return n??null}({queryString:t,groupId:n});return[(0,l.aZ)(r),(0,o.useCallback)((e=>{if(!r)return;const t=new URLSearchParams(s.location.search);t.set(r,e),s.replace({...s.location,search:t.toString()})}),[r,s])]}function m(e){const{defaultValue:t,queryString:n=!1,groupId:s}=e,r=h(e),[i,l]=(0,o.useState)((()=>function(e){let{defaultValue:t,tabValues:n}=e;if(0===n.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(t){if(!p({value:t,tabValues:n}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${t}" but none of its children has the corresponding value. Available values are: ${n.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return t}const o=n.find((e=>e.default))??n[0];if(!o)throw new Error("Unexpected error: 0 tabValues");return o.value}({defaultValue:t,tabValues:r}))),[d,u]=b({queryString:n,groupId:s}),[m,_]=function(e){let{groupId:t}=e;const n=function(e){return e?`docusaurus.tab.${e}`:null}(t),[s,r]=(0,c.Dv)(n);return[s,(0,o.useCallback)((e=>{n&&r.set(e)}),[n,r])]}({groupId:s}),f=(()=>{const e=d??m;return p({value:e,tabValues:r})?e:null})();(0,a.A)((()=>{f&&l(f)}),[f]);return{selectedValue:i,selectValue:(0,o.useCallback)((e=>{if(!p({value:e,tabValues:r}))throw new Error(`Can't select invalid tab value=${e}`);l(e),u(e),_(e)}),[u,_,r]),tabValues:r}}var _=n(92303);const f={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var g=n(74848);function x(e){let{className:t,block:n,selectedValue:o,selectValue:i,tabValues:a}=e;const l=[],{blockElementScrollPositionUntilNextRender:d}=(0,r.a_)(),c=e=>{const t=e.currentTarget,n=l.indexOf(t),s=a[n].value;s!==o&&(d(t),i(s))},u=e=>{let t=null;switch(e.key){case"Enter":c(e);break;case"ArrowRight":{const n=l.indexOf(e.currentTarget)+1;t=l[n]??l[0];break}case"ArrowLeft":{const n=l.indexOf(e.currentTarget)-1;t=l[n]??l[l.length-1];break}}t?.focus()};return(0,g.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,s.A)("tabs",{"tabs--block":n},t),children:a.map((e=>{let{value:t,label:n,attributes:r}=e;return(0,g.jsx)("li",{role:"tab",tabIndex:o===t?0:-1,"aria-selected":o===t,ref:e=>l.push(e),onKeyDown:u,onClick:c,...r,className:(0,s.A)("tabs__item",f.tabItem,r?.className,{"tabs__item--active":o===t}),children:n??t},t)}))})}function j(e){let{lazy:t,children:n,selectedValue:s}=e;const r=(Array.isArray(n)?n:[n]).filter(Boolean);if(t){const e=r.find((e=>e.props.value===s));return e?(0,o.cloneElement)(e,{className:"margin-top--md"}):null}return(0,g.jsx)("div",{className:"margin-top--md",children:r.map(((e,t)=>(0,o.cloneElement)(e,{key:t,hidden:e.props.value!==s})))})}function v(e){const t=m(e);return(0,g.jsxs)("div",{className:(0,s.A)("tabs-container",f.tabList),children:[(0,g.jsx)(x,{...t,...e}),(0,g.jsx)(j,{...t,...e})]})}function y(e){const t=(0,_.A)();return(0,g.jsx)(v,{...e,children:u(e.children)},String(t))}}}]);