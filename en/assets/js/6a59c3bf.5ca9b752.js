"use strict";(self.webpackChunkrdk_doc=self.webpackChunkrdk_doc||[]).push([[7480],{90224:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>t,default:()=>h,frontMatter:()=>d,metadata:()=>o,toc:()=>c});var i=s(74848),r=s(28453);const d={sidebar_position:9},t="BPU Driver sysfs debugging interface",o={id:"Advanced_development/linux_development/driver_development/driver_bpu_sysfs_dev",title:"BPU Driver sysfs debugging interface",description:"BPU sysfs node description",source:"@site/i18n/en/docusaurus-plugin-content-docs/current/07_Advanced_development/02_linux_development/driver_development/driver_bpu_sysfs_dev.md",sourceDirName:"07_Advanced_development/02_linux_development/driver_development",slug:"/Advanced_development/linux_development/driver_development/driver_bpu_sysfs_dev",permalink:"/rdk_doc/en/Advanced_development/linux_development/driver_development/driver_bpu_sysfs_dev",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/07_Advanced_development/02_linux_development/driver_development/driver_bpu_sysfs_dev.md",tags:[],version:"current",sidebarPosition:9,frontMatter:{sidebar_position:9},sidebar:"tutorialSidebar",previous:{title:"PWM Drive Debugging Guide",permalink:"/rdk_doc/en/Advanced_development/linux_development/driver_development/driver_pwm_dev"},next:{title:"Thermal System",permalink:"/rdk_doc/en/Advanced_development/linux_development/driver_development/driver_thermal_dev"}},l={},c=[{value:"BPU sysfs node description",id:"bpu-sysfs-node-description",level:2},{value:"Usage Example",id:"usage-example",level:2},{value:"Disable BPU Core",id:"disable-bpu-core",level:3},{value:"Hot-Swap BPU Core",id:"hot-swap-bpu-core",level:3},{value:"Reduce BPU Core Power Consumption",id:"reduce-bpu-core-power-consumption",level:3},{value:"Priority Model Usage",id:"priority-model-usage",level:3}];function a(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h1,{id:"bpu-driver-sysfs-debugging-interface",children:"BPU Driver sysfs debugging interface"}),"\n",(0,i.jsx)(n.h2,{id:"bpu-sysfs-node-description",children:"BPU sysfs node description"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"/sys/devices/system/bpu\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"image",src:s(49927).A+"",width:"728",height:"87"})}),"\n",(0,i.jsx)(n.p,{children:'The information of each file node can be obtained using the "cat" command or set using the "echo" command. The specific contents are as follows:'}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"bpu*: directory, bpu0 and bpu1 correspond to the two cores of the bpu respectively, and the nodes in each directory are set as follows:"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"image",src:s(98863).A+"",width:"950",height:"191"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"burst_len: read/write file, burst_len corresponding to the core"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"hotplug: read/write file, whether hotplugging is enabled for the core:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"0: disable;"}),"\n",(0,i.jsx)(n.li,{children:"1: enable;"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"power_enable: read/write file, power switch of the core, used to turn on/off the corresponding BPU core hardware power;"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"devfreq: read/write file, used to read/set the frequency of the core:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:'Taking BPU0 as an example, set the frequency scaling policy to "userspace"'}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"echo userspace > /sys/devices/system/bpu/bpu0/devfreq/devfreq*/governor\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"View the supported frequencies of BPU:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"cat /sys/devices/system/bpu/bpu0/devfreq/devfreq*/available_frequencies\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Set BPU to the target frequency, the target frequency must be supported by BPU:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"echo 200000000 > /sys/devices/system/bpu/bpu0/devfreq/devfreq*/userspace/set_freq\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Confirm the set frequency:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"cat /sys/devices/system/bpu/bpu0/devfreq/devfreq*/available_frequencies\n"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"limit: Read/write file used to set the number of buffers related to the Core hardware. The default value is 0, any value greater than 0 is the actual number of buffers. It is related to priority, where smaller positive values have higher priority and the task is scheduled earlier, but the efficiency of task switching would be reduced. Users should set this based on the actual situation."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"power_level: Read/write file used to set the power level at which the Core operates (including power supply and frequency):"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"1: Linux dvf dynamic adjustment"}),"\n",(0,i.jsx)(n.li,{children:"0: Performance priority, highest power consumption"}),"\n",(0,i.jsx)(n.li,{children:"< 0: Within range, smaller values correspond to lower power consumption levels"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"users: Read-only file used to obtain user information using the Core. Refer to the users section below for detailed information."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"queue: Read-only file used to obtain the number of FunctionCall that the driver can currently set."}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{src:s(18440).A+"",width:"1042",height:"54"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"ratio: Read-only file used to obtain utilization information of the Core."}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{src:s(5999).A+"",width:"1037",height:"62"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"fc_time: Obtain information about fc tasks processed on the Core. Each task has the following sub-items:"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{src:s(32433).A+"",width:"644",height:"28"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"index: The position of the task in the BPU hardware FIFO"}),"\n",(0,i.jsx)(n.li,{children:"id: User-defined interrupt id"}),"\n",(0,i.jsx)(n.li,{children:"hwid: Interrupt id maintained by the underlying driver"}),"\n",(0,i.jsx)(n.li,{children:"group: User-defined group id, user process id"}),"\n",(0,i.jsx)(n.li,{children:"prio: Task priority"}),"\n",(0,i.jsx)(n.li,{children:"s_time: Timestamp of the start of task processing"}),"\n",(0,i.jsx)(n.li,{children:"e_time: Timestamp of the end of task processing"}),"\n",(0,i.jsx)(n.li,{children:"r_time: Total execution time of the task"}),"\n",(0,i.jsx)(n.li,{children:"core_num: Read-only file, the number of cores in the BPU hardware"}),"\n",(0,i.jsx)(n.li,{children:'group: Read-only file, information about task groups running on the BPU. Can be obtained by running "cat group":'}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{src:s(65488).A+"",width:"828",height:"111"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["group: User-defined group id and process id;","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"prop: User-defined proportion value"}),"\n",(0,i.jsx)(n.li,{children:"ratio: Current actual utilization ratio"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.li,{children:"ratio: Read-only file, current utilization of the BPU"}),"\n",(0,i.jsx)(n.li,{children:'users: Read-only file, current users of the BPU. Users are classified as those who set tasks through the BPU framework and those who specify tasks for each Core. Can be obtained by running "cat users":'}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{src:s(24971).A+"",width:"833",height:"217"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"user: User process ID"}),"\n",(0,i.jsx)(n.li,{children:"ratio: The corresponding occupancy rate of the user on the Core"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"usage-example",children:"Usage Example"}),"\n",(0,i.jsx)(n.p,{children:"All cases in the following text target BPU0. All commands can be executed after running the model application."}),"\n",(0,i.jsx)(n.h3,{id:"disable-bpu-core",children:"Disable BPU Core"}),"\n",(0,i.jsx)(n.p,{children:"Execute the following command:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"echo 0 > /sys/devices/system/bpu/bpu0/power_enable\n"})}),"\n",(0,i.jsx)(n.h3,{id:"hot-swap-bpu-core",children:"Hot-Swap BPU Core"}),"\n",(0,i.jsx)(n.p,{children:"Hot-Swapping does not affect the running of single-core model applications and is not supported for dual-core model applications. Once Hot-Swapping is enabled, it will not be disabled by default. If you need to disable Hot-Swapping, please set it manually (echo 0 to the corresponding sysfs node). Execute the following commands in order:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"echo 1 > /sys/devices/system/bpu/bpu0/hotplug\necho 0 > /sys/devices/system/bpu/bpu0/power_enable\n"})}),"\n",(0,i.jsx)(n.h3,{id:"reduce-bpu-core-power-consumption",children:"Reduce BPU Core Power Consumption"}),"\n",(0,i.jsx)(n.p,{children:"This command does not shut down the BPU core, but only lowers the corresponding core frequency/power consumption. For specific values and corresponding meanings, please refer to the above text:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"echo -2 > /sys/devices/system/bpu/bpu0/power_level\n"})}),"\n",(0,i.jsx)(n.h3,{id:"priority-model-usage",children:"Priority Model Usage"}),"\n",(0,i.jsx)(n.p,{children:"Compile and use priority models according to the relevant instructions of HBDK compiler. Set tasks using the hb_bpu_core_set_fc_prio interface or the hb_bpu_core_set_fc_group interface with a specific group_id:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"echo 2 > /sys/devices/system/bpu/bpu0/limit\n"})}),"\n",(0,i.jsx)(n.p,{children:"The limit interface can be used for debugging. Users can also use the following command to set environment variables when executing applications:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"export BPLAT_CORELIMIT=2\n"})})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(a,{...e})}):a(e)}},49927:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/15b0a3742a6721d475db1a6e21b1809e-9012d32f148ce94029cc18fee15c6766.png"},5999:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/2724e46795d0798ea433eb990be22149-11fa68b430d2e5cd0a56713154bee884.png"},18440:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/4edf614de291d4c7005d01be0cc10041-0d338616b36560f9b1ce9bd3a5c0e202.png"},98863:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/550eb60c5eb1a66ca126be088c08d9b5-d9119c131063708fc78c260b45885ba1.png"},32433:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/6cad811f2afb4fa4984ad3c44ae0f5aa-42f8b554240ab851530f3ec688de0c51.png"},24971:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/b898a1588bd4a94e332a5dbd9bd8f46a-767fded4a016ab70514d243b20dd256d.png"},65488:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/f90196d698265775d78717a9ab9967ce-d61c1345db7b7f3d508937278dbe502b.png"},28453:(e,n,s)=>{s.d(n,{R:()=>t,x:()=>o});var i=s(96540);const r={},d=i.createContext(r);function t(e){const n=i.useContext(d);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:t(e.components),i.createElement(d.Provider,{value:n},e.children)}}}]);