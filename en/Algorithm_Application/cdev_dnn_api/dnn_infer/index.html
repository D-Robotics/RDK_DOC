<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-Algorithm_Application/cdev_dnn_api/dnn_infer" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.4.0">
<title data-rh="true">4.2.4 Model Inference API | RDK DOC</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://developer.d-robotics.cc/rdk_doc/en/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://developer.d-robotics.cc/rdk_doc/en/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://developer.d-robotics.cc/rdk_doc/en/Algorithm_Application/cdev_dnn_api/dnn_infer"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" property="og:locale:alternate" content="zh_Hans"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="4.2.4 Model Inference API | RDK DOC"><meta data-rh="true" name="description" content="hbDNNInfer()"><meta data-rh="true" property="og:description" content="hbDNNInfer()"><link data-rh="true" rel="icon" href="/rdk_doc/en/img/logo.png"><link data-rh="true" rel="canonical" href="https://developer.d-robotics.cc/rdk_doc/en/Algorithm_Application/cdev_dnn_api/dnn_infer"><link data-rh="true" rel="alternate" href="https://developer.d-robotics.cc/rdk_doc/Algorithm_Application/cdev_dnn_api/dnn_infer" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://developer.d-robotics.cc/rdk_doc/en/Algorithm_Application/cdev_dnn_api/dnn_infer" hreflang="en"><link data-rh="true" rel="alternate" href="https://developer.d-robotics.cc/rdk_doc/Algorithm_Application/cdev_dnn_api/dnn_infer" hreflang="x-default"><script src="https://hm.baidu.com/hm.js?24dd63cad43b63889ea6bede5fd1ab9e" async></script><link rel="stylesheet" href="/rdk_doc/en/assets/css/styles.c60d9ce6.css">
<script src="/rdk_doc/en/assets/js/runtime~main.7e8f907b.js" defer="defer"></script>
<script src="/rdk_doc/en/assets/js/main.957ade16.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/rdk_doc/en/"><div class="navbar__logo"><img src="/rdk_doc/en/img/logo.png" alt="My Site Logo" class="themedComponent__dKv themedComponent--light_rzkv"><img src="/rdk_doc/en/img/logo.png" alt="My Site Logo" class="themedComponent__dKv themedComponent--dark_mMAk"></div><b class="navbar__title text--truncate">D-Robotics</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/rdk_doc/en/RDK">RDK</a><a href="https://developer.d-robotics.cc/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Community<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/D-Robotics" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link" href="/rdk_doc/en/Algorithm_Application/cdev_dnn_api/dnn_infer"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>EN</a><ul class="dropdown__menu"><li><a href="/rdk_doc/Algorithm_Application/cdev_dnn_api/dnn_infer" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="zh-Hans">CN</a></li><li><a href="/rdk_doc/en/Algorithm_Application/cdev_dnn_api/dnn_infer" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="en">EN</a></li></ul></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="navbar__search searchBarContainer_NW3z" dir="ltr"><input placeholder="Search" aria-label="Search" class="navbar__search-input"><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/rdk_doc/en/RDK">D-Robotics  RDK Suite</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/rdk_doc/en/Quick_start">1.Quick Start</a><button aria-label="Expand sidebar category &#x27;1.Quick Start&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/rdk_doc/en/System_configuration">2. System Configuration</a><button aria-label="Expand sidebar category &#x27;2. System Configuration&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/rdk_doc/en/Basic_Application">3 Basic Application Development</a><button aria-label="Expand sidebar category &#x27;3 Basic Application Development&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/rdk_doc/en/Basic_Development">4. Algorithm Application Development</a><button aria-label="Collapse sidebar category &#x27;4. Algorithm Application Development&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/rdk_doc/en/Algorithm_Application/pydev_dnn_demo/pydev_dnn_demo">4.1 Python Model Inference Example</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/rdk_doc/en/Algorithm_Application/cdev_dnn_api/cdev_dnn_api">4.2 C++ Model Inference Interface Description</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/rdk_doc/en/Algorithm_Application/cdev_dnn_api/cdev_dnn_api">Model Inference Interface Instructions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/rdk_doc/en/Algorithm_Application/cdev_dnn_api/get_version">4.2.1 Model Inference Library Version Information Retrieval API</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/rdk_doc/en/Algorithm_Application/cdev_dnn_api/initialize_and_release">4.2.2 Model Load/Unload API</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/rdk_doc/en/Algorithm_Application/cdev_dnn_api/get_model_info">4.2.3 Model Information Retrieval API</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/rdk_doc/en/Algorithm_Application/cdev_dnn_api/dnn_infer">4.2.4 Model Inference API</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/rdk_doc/en/Algorithm_Application/cdev_dnn_api/sys_mem">4.2.5 Model Memory Operation API</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/rdk_doc/en/Algorithm_Application/cdev_dnn_api/dnn_resize">4.2.6 Model Pre-processing API</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/rdk_doc/en/Algorithm_Application/cdev_dnn_api/data_struct">4.2.7 Data Types and Data Structures</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/rdk_doc/en/Algorithm_Application/cdev_dnn_api/data_alignment">4.2.8 Data Layout and Alignment Rules</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/rdk_doc/en/Algorithm_Application/cdev_dnn_api/model_debug">4.2.9 Model Inference DEBUG Method</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/rdk_doc/en/Algorithm_Application/model_zoo/model_zoo_intro">4.3 Model Repository Example</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/rdk_doc/en/Robot_development">5. Robotics Application Development</a><button aria-label="Expand sidebar category &#x27;5. Robotics Application Development&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/rdk_doc/en/Application_case">6. Application Development Guide</a><button aria-label="Expand sidebar category &#x27;6. Application Development Guide&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/rdk_doc/en/Advanced_development">7. Advanced Development</a><button aria-label="Expand sidebar category &#x27;7. Advanced Development&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/rdk_doc/en/FAQ">8. FAQs</a><button aria-label="Expand sidebar category &#x27;8. FAQs&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/rdk_doc/en/Appendix">9. Appendix</a><button aria-label="Expand sidebar category &#x27;9. Appendix&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/rdk_doc/en/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/rdk_doc/en/Basic_Development"><span itemprop="name">4. Algorithm Application Development</span></a><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">4.2 C++ Model Inference Interface Description</span><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">4.2.4 Model Inference API</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>4.2.4 Model Inference API</h1>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="hbdnninfer">hbDNNInfer()<a class="hash-link" aria-label="Direct link to hbDNNInfer()" title="Direct link to hbDNNInfer()" href="/rdk_doc/en/Algorithm_Application/cdev_dnn_api/dnn_infer#hbdnninfer">​</a></h2>
<p><strong>【Function Prototype】</strong></p>
<p><code>int32_t hbDNNInfer(hbDNNTaskHandle_t *taskHandle, hbDNNTensor **output, const hbDNNTensor *input, hbDNNHandle_t dnnHandle, hbDNNInferCtrlParam *inferCtrlParam)</code></p>
<p><strong>【Description】</strong></p>
<p>Execute an inference task based on the input parameters. The caller can use the returned <code>taskHandle</code> across functions and threads.</p>
<p><strong>【Parameters】</strong></p>
<ul>
<li>[out]     <code>taskHandle</code>          Pointer to the task handle.</li>
<li>[in/out]  <code>output</code>              Output of the inference task.</li>
<li>[in]      <code>input</code>               Input of the inference task.</li>
<li>[in]      <code>dnnHandle</code>           Pointer to the DNN handle.</li>
<li>[in]      <code>inferCtrlParam</code>      Parameters to control the inference task.</li>
</ul>
<p><strong>【Return Type】</strong></p>
<ul>
<li>Returns <code>0</code> if the API is executed successfully, otherwise it fails.</li>
</ul>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>Note</div><div class="admonitionContent_BuS1"><p>When using this interface to submit a task, the <code>taskHandle</code> should be set to <code>nullptr</code> in advance, unless it is to append a task to the specified <code>taskHandle</code> (i.e., using the <code>inferCtrlParam::more</code> function).</p><p>Up to 32 model tasks are supported at the same time.</p><p>For batch models, it is allowed to set the memory address of input tensors separately. For example, if the input validShape/alignedShape of the model is [4, 3, 224, 224], you can allocate four hbDNNTensors, and set the validShape/alignedShape of each hbDNNTensor as [1, 3, 224, 224] to store the data of each batch. When the model has multiple inputs, the order of <code>input</code> should be input0[batch0], input0[batch1], ..., inputn[batch0], inputn[batch1], ....</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="hbdnnroiinfer">hbDNNRoiInfer()<a class="hash-link" aria-label="Direct link to hbDNNRoiInfer()" title="Direct link to hbDNNRoiInfer()" href="/rdk_doc/en/Algorithm_Application/cdev_dnn_api/dnn_infer#hbdnnroiinfer">​</a></h2>
<p><strong>【Function Prototype】</strong></p>
<p><code>int32_t hbDNNRoiInfer(hbDNNTaskHandle_t *taskHandle, hbDNNTensor **output, const hbDNNTensor *input, hbDNNRoi *rois, int32_t roiCount, hbDNNHandle_t dnnHandle, hbDNNInferCtrlParam *inferCtrlParam)</code></p>
<p><strong>【Description】</strong></p>
<p>Execute an ROI inference task based on the input parameters. The caller can use the returned <code>taskHandle</code> across functions and threads.</p>
<p><strong>[Parameters]</strong></p>
<ul>
<li>[out]     <code>taskHandle</code>       Pointer to the task handle.</li>
<li>[in/out]  <code>output</code>           Output of the inference task.</li>
<li>[in]      <code>input</code>            Input of the inference task.</li>
<li>[in]      <code>rois</code>             Roi box information.</li>
<li>[in]      <code>roiCount</code>         Number of roi boxes.</li>
<li>[in]      <code>dnnHandle</code>        Pointer to the dnn handle.</li>
<li>[in]      <code>inferCtrlParam</code>   Parameters to control the inference task.</li>
</ul>
<p><strong>[Return Type]</strong></p>
<ul>
<li>Returns <code>0</code> if the API is executed successfully, otherwise it fails.</li>
</ul>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>Note</div><div class="admonitionContent_BuS1"><p>If using <strong>RDK X3</strong>, follow these rules:
| This interface supports batch processing, assuming the number of data batches to be inferred is <code>batch</code>, and the number of model inputs is <code>input_count</code>, where the number of input sources for the resizer is <code>resizer_count</code>.
| Prepare input parameter <code>input</code>: The range of the array index of <code>input</code> for the i-th <code>batch</code> is <code>[i * input\_count</code>, <code>(i + 1) * input\_count)，i=[0,batch)</code>.
| Prepare input parameter <code>rois</code>: Each input source for the resizer should match a roi. The range of the array index of <code>rois</code> for the i-th <code>batch</code> is <code>[i * resizer\_count</code>, <code>(i + 1) * resizer\_count)，i=[0,batch)</code>. The order of rois in each batch should be consistent with the order of the inputs.
| Limit on the number of <code>batch</code>: The range should be [1, 255].</p><p>Model Limitations: The compilation parameter <code>input_source</code> of the model needs to be set to <code>resizer</code> during compilation, and the h*w of the model should be less than 18432.</p><p>When submitting a task using this interface, the <code>taskHandle</code> should be set to <code>nullptr</code> in advance, unless it is appending a task to the specified <code>taskHandle</code> (i.e. using the <code>inferCtrlParam::more</code> function).</p><p>The <code>left</code> and <code>top</code> values of the <code>roi</code> must be even, while the <code>right</code> and <code>bottom</code> values must be odd.</p><p>The size of the <code>roi</code> must satisfy the following requirements: <code>16 &lt;= width &lt; 256</code>, <code>16 &lt;= height &lt; 256</code>.</p><p>The scaling range is <code>0.5 &lt; roi / src &lt;= 8</code>.</p><p>Currently, up to 32 model tasks can exist simultaneously.</p><p>API Example: Please refer to the <code>roi_infer.sh</code> instructions in <a href="/rdk_doc/en/07_Advanced_development/04_toolchain_development/intermediate/runtime_sample#model-inference-dnn-api-usage-examples">Model Inference DNN API Usage Example Documentation</a> for more details.</p><p>Model Limitations: During the model conversion, set the compilation parameter input_source to <code>{&#x27;input_name&#x27;: &#x27;resizer&#x27;}</code> to generate a resizer model. For specific parameter configuration details, refer to the introduction in <a href="/rdk_doc/en/07_Advanced_development/04_toolchain_development/intermediate/ptq_process#model-conversion">PTQ Quantization Principles and Steps for Model Conversion</a>.</p><p><img decoding="async" loading="lazy" alt="resizer" src="/rdk_doc/en/assets/images/resizer-940b38d4287ce03b7100e53745da8855.png" width="1066" height="275" class="img_ev3q"></p><p>Currently, NV12 data with multiple inputs is also supported. The commonly used output sizes (HxW) of the resizer are: 128x128, 128x64, 64x128, 160x96.</p></div></div>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>Note</div><div class="admonitionContent_BuS1"><p>If using <strong>RDK Ultra</strong>, follow these rules:</p><ul>
<li><code>input_count</code>: Number of model input branches</li>
<li><code>output_count</code>: Number of model output branches</li>
<li><code>resizer_count</code>: Number of resizer input-source branches in the model (≤input_count). When the model processes a batch of data, one resizer input-source branch handles one roi.</li>
<li><code>roiCount</code>: Total number of rois, its value is <code>batch * resizer_count</code></li>
<li><code>data_batch</code>: The number of data batches that the model needs to infer, its value is <code>roiCount / resizer_count</code></li>
<li><code>model_batch</code>: The batch size used internally by the model, i.e., the batch_size input to the model during inference. D-Robotics Toolchain supports compiling the model as a batch model.</li>
</ul><p>Input/Output Example Explanation:</p><p>Taking a more complex multi-input model as an example, let&#x27;s assume the model has 3 input branches (2 resizer inputs, 1 ddr input) and 1 output branch, and is compiled with <code>batch=2</code>. The model needs to process a total of 3 batches of data, with 6 rois in total (i.e., 2 rois per data batch). Given the following information:</p><ul>
<li><code>input_count</code> = 3</li>
<li><code>output_count</code> = 1</li>
<li><code>resizer_count</code> = 2</li>
<li><code>roiCount</code> = 6</li>
<li><code>data_batch</code> = 3</li>
<li><code>model_batch</code> = 2</li>
</ul><p>So for model inference, these three batches of data need to prepare <code>input_count * data_batch = 9</code> input-tensors with independent addresses.</p><p>Assuming the static information of the model input/output is as follows:</p><ul>
<li>
<p>Model Input (model_info):</p>
<ul>
<li>tensor_0_resizer: [2, 3, 128, 128]</li>
<li>tensor_1_resizer: [2, 3, 256, 256]</li>
<li>tensor_2_ddr: [2, 80, 1, 100]</li>
</ul>
</li>
<li>
<p>Model Output (model_info):</p>
<ul>
<li>tensor_out: [2, 100, 1, 56]</li>
</ul>
</li>
</ul><p>Then the dynamic information of the model during inference is:</p><ul>
<li>
<p>Model Input (input_tensors):</p>
<ul>
<li>[1x3x128x128, 1x3x256x256, 1x80x1x100, 1x3x128x128, 1x3x256x256, 1x80x1x100, 1x3x128x128, 1x3x256x256, 1x80x1x100]</li>
</ul>
</li>
<li>
<p>Model Output (output_tensors):</p>
<ul>
<li>[4x100x1x56]</li>
</ul>
</li>
</ul><p>Here, because <code>model_batch = 2</code>, the underlying BPU can handle 2 batches of data in a single execution. And because <code>data_batch = 3</code>, the highest dimension of the output_tensor is calculated using the formula <code>ceil[(data_batch) / model_batch] * model_batch</code>, which is always a multiple of <code>model_batch</code>. This is also a hardware instruction requirement of the BPU, and any missing inputs will be automatically ignored during computation.</p><p>Interface Limitations Explanation:</p><ul>
<li>Regarding the <code>batch</code> number limitation: its range should be [1, 255].</li>
<li>When using this interface to submit a task, <code>taskHandle</code> should be set to <code>nullptr</code> in advance, unless it is appending a task to a specific <code>taskHandle</code> (i.e., using the <code>inferCtrlParam::more</code> functionality).</li>
<li>The roi size requirement is: <code>2 &lt;= width &lt;= 4096</code>, <code>2 &lt;= height &lt;= 4096</code>.</li>
<li>The original image size requirement is: <code>1 &lt;= W &lt;= 4096</code>, <code>16 &lt;= stride &lt;= 131072</code>, and <code>stride</code> must be a multiple of 16.</li>
<li>The output size requirement is: <code>2 &lt;= Wout</code>, <code>2 &lt;= Hout</code>.</li>
<li>The roi scaling factor limit is: <code>0 &lt;= step &lt;= 262143</code>, where the step is calculated using the formula: <code>step = ((src_len - 1)*65536 + (dst_len - 1)/2)/(dst_len - 1)</code>, where src_len is the W or H of the roi and dst_len is the required W or H of the model.</li>
<li>Up to 32 model tasks can exist simultaneously.</li>
</ul></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="hbdnnwaittaskdone">hbDNNWaitTaskDone()<a class="hash-link" aria-label="Direct link to hbDNNWaitTaskDone()" title="Direct link to hbDNNWaitTaskDone()" href="/rdk_doc/en/Algorithm_Application/cdev_dnn_api/dnn_infer#hbdnnwaittaskdone">​</a></h2>
<p><strong>【Function prototype】</strong></p>
<p><code>int32_t hbDNNWaitTaskDone(hbDNNTaskHandle_t taskHandle, int32_t timeout)</code></p>
<p><strong>【Description】</strong></p>
<p>Wait for task completion or timeout.</p>
<p><strong>【Parameters】</strong></p>
<ul>
<li>[in]  <code>taskHandle</code>         Pointer to the task handle.</li>
<li>[in]  <code>timeout</code>            Timeout configuration (in milliseconds).</li>
</ul>
<p><strong>【Return type】</strong></p>
<ul>
<li>Returns <code>0</code> if the API is executed successfully, otherwise it fails.</li>
</ul>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>Note</div><div class="admonitionContent_BuS1"><ol>
<li><code>timeout &gt; 0</code> indicates the waiting time;</li>
<li><code>timeout &lt;= 0</code> indicates waiting until the task is completed.</li>
</ol></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="hbdnnreleasetask">hbDNNReleaseTask()<a class="hash-link" aria-label="Direct link to hbDNNReleaseTask()" title="Direct link to hbDNNReleaseTask()" href="/rdk_doc/en/Algorithm_Application/cdev_dnn_api/dnn_infer#hbdnnreleasetask">​</a></h2>
<p><strong>【Function prototype】</strong></p>
<p><code>int32_t hbDNNReleaseTask(hbDNNTaskHandle_t taskHandle)</code></p>
<p><strong>【Description】</strong></p>
<p>Release the task. If the task is not executed, it will be canceled and released directly. If it has been executed, it will be canceled and released after running to certain nodes.</p>
<p><strong>【Parameters】</strong></p>
<ul>
<li>[in]  <code>taskHandle</code>         Pointer to the task handle.</li>
</ul>
<p><strong>【Return type】</strong></p>
<ul>
<li>Returns <code>0</code> if the API is executed successfully, otherwise it fails.</li>
</ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://d-robotics.github.io/rdk_doc/RDK/docs/04_Algorithm_Application/02_cdev_dnn_api/dnn_infer.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/rdk_doc/en/Algorithm_Application/cdev_dnn_api/get_model_info"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">4.2.3 Model Information Retrieval API</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/rdk_doc/en/Algorithm_Application/cdev_dnn_api/sys_mem"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">4.2.5 Model Memory Operation API</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a class="table-of-contents__link toc-highlight" href="/rdk_doc/en/Algorithm_Application/cdev_dnn_api/dnn_infer#hbdnninfer">hbDNNInfer()</a></li><li><a class="table-of-contents__link toc-highlight" href="/rdk_doc/en/Algorithm_Application/cdev_dnn_api/dnn_infer#hbdnnroiinfer">hbDNNRoiInfer()</a></li><li><a class="table-of-contents__link toc-highlight" href="/rdk_doc/en/Algorithm_Application/cdev_dnn_api/dnn_infer#hbdnnwaittaskdone">hbDNNWaitTaskDone()</a></li><li><a class="table-of-contents__link toc-highlight" href="/rdk_doc/en/Algorithm_Application/cdev_dnn_api/dnn_infer#hbdnnreleasetask">hbDNNReleaseTask()</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Links</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.guyuehome.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">GuYueHome<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Contact US</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/D-Robotics" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://space.bilibili.com/437998606" target="_blank" rel="noopener noreferrer" class="footer__link-item">Youtube<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 D-Robotics.</div></div></div></footer></div>
</body>
</html>